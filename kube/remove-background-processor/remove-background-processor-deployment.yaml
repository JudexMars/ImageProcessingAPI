apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    kompose.cmd: kompose convert -f compose.yaml
    kompose.version: 1.34.0 (HEAD)
  labels:
    io.kompose.service: remove-background-processor
  name: remove-background-processor
spec:
  replicas: 1
  selector:
    matchLabels:
      io.kompose.service: remove-background-processor
  template:
    metadata:
      annotations:
        kompose.cmd: kompose convert -f compose.yaml
        kompose.version: 1.34.0 (HEAD)
      labels:
        io.kompose.service: remove-background-processor
    spec:
      containers:
        - env:
            - name: BOOTSTRAP_SERVERS
              value: kafka-1:9082,kafka-2:9083,kafka-3:9084
            - name: DONE_TOPIC
              value: images.done
            - name: KAFKA_SASL_MECHANISM
              value: PLAIN
            - name: KAFKA_SASL_PLAIN_PASSWORD
              value: admin-secret
            - name: KAFKA_SASL_PLAIN_USERNAME
              value: admin
            - name: KAFKA_SECURITY_PROTOCOL
              value: SASL_SSL
            - name: KAFKA_SSL_CAFILE
              value: /run/custom-secrets/ssl-cafile
            - name: KAFKA_SSL_CERTFILE
              value: /run/custom-secrets/ssl-certfile
            - name: KAFKA_SSL_KEYFILE
              value: /run/custom-secrets/ssl-keyfile
            - name: MINIO_ACCESS_KEY
              value: judex
            - name: MINIO_ENDPOINT
              value: image-crud-s3:9000
            - name: MINIO_SECRET_KEY
              value: password
            - name: WIP_TOPIC
              value: images.wip
          image: judexmars/cv-image-processor:1.0.0
          name: remove-background-processor
          volumeMounts:
            - mountPath: /run/custom-secrets
              name: secret-files
      restartPolicy: Always
      volumes:
        - name: secret-files
          projected:
            sources:
              - secret:
                  name: ssl-keyfile
              - secret:
                  name: ssl-certfile
              - secret:
                  name: ssl-cafile
